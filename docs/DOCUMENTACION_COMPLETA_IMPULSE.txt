# ğŸ“‹ **IMPULSE - DocumentaciÃ³n TÃ©cnica Completa**

## **ğŸ¯ Resumen Ejecutivo**

**IMPULSE** es una aplicaciÃ³n web full-stack de **gamificaciÃ³n de hÃ¡bitos y gestiÃ³n de retos personales**. Permite a los usuarios crear retos, reportar progreso con evidencias multimedia, y contar con un sistema de validaciÃ³n por pares. La arquitectura estÃ¡ diseÃ±ada para escalabilidad, accesibilidad y experiencia de usuario moderna.

---

## **ğŸ—ï¸ Arquitectura del Sistema**

### **Stack TecnolÃ³gico**

| Componente | TecnologÃ­a | VersiÃ³n | JustificaciÃ³n |
|------------|------------|---------|---------------|
| **Frontend** | React + TypeScript | 19.1.1 | SPA moderna, type-safe, componentes reutilizables |
| **Backend** | Spring Boot + Java | 3.5.4 / Java 21 | Microservicios, seguridad robusta, ecosistema maduro |
| **Base de Datos** | MySQL | 5.5.5+ | Relacional, transaccional, amplio soporte |
| **Build Tool** | Maven (Backend) + CRA | 3.9+ / 5.0.1 | GestiÃ³n de dependencias estÃ¡ndar |
| **AutenticaciÃ³n** | JWT + Spring Security | - | Stateless, escalable, estÃ¡ndar industria |

### **Arquitectura de 3 Capas**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                FRONTEND                     â”‚
â”‚  React 19 + TypeScript + CSS Variables     â”‚
â”‚  â”œâ”€â”€ Pages (14 rutas principales)          â”‚
â”‚  â”œâ”€â”€ Components reutilizables              â”‚
â”‚  â”œâ”€â”€ Hooks personalizados                  â”‚
â”‚  â””â”€â”€ Context API (estado global)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†• HTTP REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                BACKEND                      â”‚
â”‚     Spring Boot + Security + JPA           â”‚
â”‚  â”œâ”€â”€ Controllers REST                      â”‚
â”‚  â”œâ”€â”€ Services (lÃ³gica de negocio)          â”‚
â”‚  â”œâ”€â”€ Repositories (acceso a datos)         â”‚
â”‚  â”œâ”€â”€ Security (JWT + RBAC)                 â”‚
â”‚  â””â”€â”€ Configuration & Filters               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†• JDBC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BASE DE DATOS                  â”‚
â”‚              MySQL 5.5.5+                  â”‚
â”‚  â”œâ”€â”€ Esquema normalizado (9 tablas)        â”‚
â”‚  â”œâ”€â”€ Stored Procedures                     â”‚
â”‚  â”œâ”€â”€ Triggers de auditorÃ­a                 â”‚
â”‚  â””â”€â”€ Migraciones Flyway                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **ğŸ“ Estructura del Proyecto**

```
Impulse/
â”œâ”€â”€ frontend/                    # React App (puerto 3000)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/              # 14 pÃ¡ginas principales
â”‚   â”‚   â”‚   â”œâ”€â”€ Home.tsx        # Landing page
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.tsx       # AutenticaciÃ³n
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx   # Panel principal
â”‚   â”‚   â”‚   â”œâ”€â”€ MisRetos.tsx    # GestiÃ³n de retos
â”‚   â”‚   â”‚   â”œâ”€â”€ Validaciones.tsx # Validar evidencias
â”‚   â”‚   â”‚   â””â”€â”€ [9 mÃ¡s...]
â”‚   â”‚   â”œâ”€â”€ components/         # Componentes reutilizables
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx      # NavegaciÃ³n
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx       # Dialogs
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx      # Botones unificados
â”‚   â”‚   â”‚   â””â”€â”€ [6 mÃ¡s...]
â”‚   â”‚   â”œâ”€â”€ contexts/           # Estado global
â”‚   â”‚   â”‚   â””â”€â”€ AppContext.tsx  # Context API principal
â”‚   â”‚   â”œâ”€â”€ hooks/              # LÃ³gica reutilizable
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts      # AutenticaciÃ³n
â”‚   â”‚   â”‚   â””â”€â”€ useReto.ts      # GestiÃ³n de retos
â”‚   â”‚   â”œâ”€â”€ services/           # API calls
â”‚   â”‚   â”‚   â””â”€â”€ authService.ts  # HTTP client
â”‚   â”‚   â”œâ”€â”€ assets/             # Recursos estÃ¡ticos
â”‚   â”‚   â”‚   â””â”€â”€ styles.css      # Sistema de diseÃ±o (1400+ lÃ­neas)
â”‚   â”‚   â””â”€â”€ i18n/               # InternacionalizaciÃ³n
â”‚   â”‚       â”œâ”€â”€ es.json         # EspaÃ±ol
â”‚   â”‚       â””â”€â”€ en.json         # InglÃ©s
â”‚   â”œâ”€â”€ package.json            # Dependencias + overrides
â”‚   â””â”€â”€ public/                 # Assets pÃºblicos
â”‚
â”œâ”€â”€ backend/                     # Spring Boot (puerto 8080)
â”‚   â”œâ”€â”€ src/main/java/com/impulse/
â”‚   â”‚   â”œâ”€â”€ application/        # Capa de aplicaciÃ³n
â”‚   â”‚   â”‚   â”œâ”€â”€ reto/          # Dominio: Retos
â”‚   â”‚   â”‚   â”œâ”€â”€ usuario/       # Dominio: Usuarios
â”‚   â”‚   â”‚   â”œâ”€â”€ evidencia/     # Dominio: Evidencias
â”‚   â”‚   â”‚   â””â”€â”€ gamificacion/  # Dominio: Puntos/Logros
â”‚   â”‚   â”œâ”€â”€ infrastructure/    # Capa de infraestructura
â”‚   â”‚   â”‚   â”œâ”€â”€ repository/    # JPA Repositories
â”‚   â”‚   â”‚   â”œâ”€â”€ notificacion/  # Telegram/WhatsApp
â”‚   â”‚   â”‚   â””â”€â”€ config/        # Configuraciones
â”‚   â”‚   â”œâ”€â”€ common/            # CÃ³digo compartido
â”‚   â”‚   â”‚   â”œâ”€â”€ security/      # JWT + RBAC + Filters
â”‚   â”‚   â”‚   â””â”€â”€ exception/     # Manejo de errores
â”‚   â”‚   â””â”€â”€ ImpulseApplication.java # Main class
â”‚   â”œâ”€â”€ src/main/resources/
â”‚   â”‚   â”œâ”€â”€ application*.yml   # Configuraciones por entorno
â”‚   â”‚   â”œâ”€â”€ messages*.properties # i18n backend
â”‚   â”‚   â””â”€â”€ db/migration/      # Scripts SQL Flyway
â”‚   â”œâ”€â”€ pom.xml                # Maven dependencies
â”‚   â””â”€â”€ target/                # Compilados
â”‚
â”œâ”€â”€ db/                         # Scripts de base de datos
â”‚   â”œâ”€â”€ setup_database.sql     # CreaciÃ³n inicial
â”‚   â”œâ”€â”€ migrations/            # Versionado de esquema
â”‚   â”‚   â”œâ”€â”€ V1__init_schema.sql
â”‚   â”‚   â””â”€â”€ V2__reto_table.sql
â”‚   â”œâ”€â”€ procedures/            # Stored procedures
â”‚   â””â”€â”€ erd/                   # Diagramas ERD
â”‚
â””â”€â”€ docs/                      # DocumentaciÃ³n
    â””â”€â”€ arquitectura/          # Diagramas y specs
```

---

## **ğŸ—„ï¸ Modelo de Datos**

### **Entidades Principales (9 tablas)**

```sql
-- USUARIOS Y AUTENTICACIÃ“N
â”œâ”€â”€ usuarios
â”‚   â”œâ”€â”€ id (PK)
â”‚   â”œâ”€â”€ email (UNIQUE)
â”‚   â”œâ”€â”€ password_hash
â”‚   â”œâ”€â”€ nombre, apellido
â”‚   â”œâ”€â”€ rol: ['USER', 'VALIDADOR', 'ADMIN']
â”‚   â”œâ”€â”€ estado: ['ACTIVO', 'INACTIVO', 'SUSPENDIDO']
â”‚   â””â”€â”€ created_at, updated_at

-- GAMIFICACIÃ“N
â”œâ”€â”€ gamificacion
â”‚   â”œâ”€â”€ usuario_id (FK)
â”‚   â”œâ”€â”€ puntos_totales
â”‚   â”œâ”€â”€ nivel
â”‚   â”œâ”€â”€ logros_desbloqueados
â”‚   â””â”€â”€ racha_actual

-- RETOS
â”œâ”€â”€ retos
â”‚   â”œâ”€â”€ id (PK)
â”‚   â”œâ”€â”€ usuario_id (FK â†’ usuarios.id)
â”‚   â”œâ”€â”€ titulo, descripcion
â”‚   â”œâ”€â”€ categoria: ['PERSONAL', 'PROFESIONAL', 'SALUD', 'EDUCACION']
â”‚   â”œâ”€â”€ dificultad: ['FACIL', 'MEDIO', 'DIFICIL', 'EXTREMO']
â”‚   â”œâ”€â”€ estado: ['ACTIVO', 'COMPLETADO', 'PAUSADO', 'CANCELADO']
â”‚   â”œâ”€â”€ fecha_inicio, fecha_fin
â”‚   â”œâ”€â”€ progreso (0-100%)
â”‚   â””â”€â”€ recompensas (JSON: puntos, logros)

-- EVIDENCIAS Y VALIDACIÃ“N
â”œâ”€â”€ evidencias
â”‚   â”œâ”€â”€ id (PK)
â”‚   â”œâ”€â”€ reto_id (FK â†’ retos.id)
â”‚   â”œâ”€â”€ usuario_id (FK â†’ usuarios.id)
â”‚   â”œâ”€â”€ tipo: ['FOTO', 'VIDEO', 'TEXTO']
â”‚   â”œâ”€â”€ contenido (URL o texto)
â”‚   â”œâ”€â”€ descripcion
â”‚   â”œâ”€â”€ estado: ['PENDIENTE', 'APROBADA', 'RECHAZADA']
â”‚   â””â”€â”€ fecha_subida

â”œâ”€â”€ validaciones
â”‚   â”œâ”€â”€ evidencia_id (FK)
â”‚   â”œâ”€â”€ validador_id (FK â†’ usuarios.id)
â”‚   â”œâ”€â”€ aprobada (BOOLEAN)
â”‚   â”œâ”€â”€ comentarios
â”‚   â””â”€â”€ fecha_validacion

-- NOTIFICACIONES
â”œâ”€â”€ notificaciones
â”‚   â”œâ”€â”€ usuario_id (FK)
â”‚   â”œâ”€â”€ tipo: ['RETO_CREADO', 'EVIDENCIA_VALIDADA', 'LOGRO_DESBLOQUEADO']
â”‚   â”œâ”€â”€ mensaje
â”‚   â”œâ”€â”€ leida
â”‚   â””â”€â”€ fecha_envio

-- AUDITORÃA
â””â”€â”€ auditoria
    â”œâ”€â”€ tabla_afectada
    â”œâ”€â”€ accion: ['INSERT', 'UPDATE', 'DELETE']
    â”œâ”€â”€ usuario_id
    â”œâ”€â”€ datos_anteriores, datos_nuevos
    â””â”€â”€ timestamp
```

### **Relaciones Clave**

- **1:N** Usuario â†’ Retos
- **1:N** Reto â†’ Evidencias  
- **N:M** Evidencia â†” Validador (tabla: validaciones)
- **1:1** Usuario â†” GamificaciÃ³n
- **1:N** Usuario â†’ Notificaciones

---

## **ğŸ” Sistema de Seguridad**

### **AutenticaciÃ³n JWT**

```java
// Flujo de autenticaciÃ³n
1. POST /api/auth/login { email, password }
2. Backend valida credenciales
3. Genera JWT con claims: { userId, rol, exp }
4. Frontend almacena token en localStorage
5. Todas las requests incluyen: Authorization: Bearer <token>
```

### **AutorizaciÃ³n RBAC (Role-Based Access Control)**

| Rol | Permisos |
|-----|----------|
| **USER** | Crear retos, subir evidencias, ver dashboard personal |
| **VALIDADOR** | Todo lo anterior + validar evidencias de otros usuarios |
| **ADMIN** | Todo lo anterior + gestiÃ³n de usuarios, mÃ©tricas del sistema |

### **Filtros de Seguridad (Spring Security Chain)**

```java
SecurityFilterChain:
1. DisableEncodeUrlFilter
2. WebAsyncManagerIntegrationFilter  
3. SecurityContextHolderFilter
4. HeaderWriterFilter (CORS, CSP)
5. CorsFilter (frontend â†” backend)
6. LogoutFilter
7. RBACFilter (custom: autorizaciÃ³n por endpoint)
8. JwtAuthenticationFilter (custom: validaciÃ³n JWT)
9. RequestCacheAwareFilter
10. SecurityContextHolderAwareRequestFilter
11. AnonymousAuthenticationFilter
12. SessionManagementFilter (STATELESS)
13. ExceptionTranslationFilter
14. AuthorizationFilter
```

---

## **ğŸš€ APIs y Endpoints**

### **AutenticaciÃ³n** `/api/auth`
```bash
POST /login        # { email, password } â†’ { token, user }
POST /register     # { email, password, nombre } â†’ { user }
POST /logout       # Invalidar token
GET  /me           # Datos usuario actual
```

### **Retos** `/api/retos`
```bash
GET    /           # Lista retos del usuario (paginado)
POST   /           # Crear nuevo reto
GET    /{id}       # Detalle de reto especÃ­fico
PUT    /{id}       # Actualizar reto
DELETE /{id}       # Eliminar/cancelar reto
GET    /{id}/progreso # EstadÃ­sticas de progreso
```

### **Evidencias** `/api/evidencias`
```bash
GET    /reto/{retoId}     # Evidencias de un reto
POST   /                 # Subir nueva evidencia
PUT    /{id}             # Actualizar evidencia
DELETE /{id}             # Eliminar evidencia
POST   /{id}/validar     # Validar evidencia (VALIDADOR+)
```

### **GamificaciÃ³n** `/api/gamificacion`
```bash
GET    /puntos           # Puntos del usuario
GET    /ranking          # Ranking global
GET    /logros           # Logros disponibles/desbloqueados
POST   /calcular-puntos  # Recalcular puntos (ADMIN)
```

---

## **ğŸ¨ Sistema de DiseÃ±o Frontend**

### **CSS Architecture**

**1400+ lÃ­neas de CSS** organizadas en:

```css
/* Sistema de variables CSS */
:root {
  --color-primary: #667eea;
  --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --shadow-lg: 0 8px 24px rgba(102, 126, 234, 0.2);
  --card-bg: rgba(255, 255, 255, 0.9);
  /* 50+ variables mÃ¡s... */
}

/* Componentes base */
.btn { /* Sistema de botones unificado */ }
.content-card { /* Cards glassmorphism */ }
.form-section { /* Formularios consistentes */ }
.stats-grid { /* Layouts de mÃ©tricas */ }

/* PÃ¡ginas especÃ­ficas */
.page-container { /* Layout universal */ }
.internal-header { /* Header pÃ¡ginas internas */ }
.auth-page { /* PÃ¡ginas de autenticaciÃ³n */ }

/* Responsive design */
@media (max-width: 768px) { /* Mobile-first */ }
```

### **Design System Features**

- **Glassmorphism**: Transparencias y blur effects
- **Gradientes dinÃ¡micos**: Colores vibrantes
- **Sombras en capas**: Profundidad visual
- **Grid responsive**: CSS Grid + Flexbox
- **Accesibilidad**: ARIA, focus management, contraste
- **Animaciones suaves**: CSS transitions + transforms

---

## **ğŸ“± PÃ¡ginas y Funcionalidades**

### **PÃ¡ginas PÃºblicas**
- **Home** (`/`): Landing page, hero section, testimonios
- **Login** (`/login`): AutenticaciÃ³n con diseÃ±o moderno
- **Register** (`/register`): Registro de nuevos usuarios

### **PÃ¡ginas Privadas (requieren autenticaciÃ³n)**
- **Dashboard** (`/dashboard`): Panel principal, estadÃ­sticas, retos activos
- **MisRetos** (`/mis-retos`): GestiÃ³n completa de retos personales
- **CrearReto** (`/crear-reto`): Formulario de creaciÃ³n de retos
- **RetoDetalle** (`/reto/{id}`): Vista detallada con progreso y evidencias
- **ReportarAvance** (`/reportar-avance`): Subida de evidencias multimedia
- **Perfil** (`/perfil`): GestiÃ³n de perfil de usuario
- **Configuracion** (`/configuracion`): Settings y preferencias

### **PÃ¡ginas de ValidaciÃ³n (VALIDADOR+)**
- **Validaciones** (`/validaciones`): Revisar evidencias pendientes
- **Validadores** (`/validadores`): GestiÃ³n de validadores

### **PÃ¡ginas Auxiliares**
- **Onboarding** (`/onboarding`): Tutorial inicial
- **Notificaciones** (`/notificaciones`): Centro de notificaciones

---

## **ğŸ”§ ConfiguraciÃ³n de Desarrollo**

### **Variables de Entorno**

**Backend** (`application-dev.yml`):
```yaml
server:
  port: 8080
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/impulse_dev
    username: ${DB_USER:impulse_user}
    password: ${DB_PASSWORD:impulse_pass}
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: true
security:
  jwt:
    secret: ${JWT_SECRET:dev-secret-key}
    expiration: 86400000  # 24 horas
notificaciones:
  telegram:
    bot-token: ${TELEGRAM_BOT_TOKEN}
  whatsapp:
    api-key: ${WHATSAPP_API_KEY}
```

**Frontend** (`.env`):
```bash
REACT_APP_API_BASE_URL=http://localhost:8080/api
REACT_APP_ENVIRONMENT=development
REACT_APP_VERSION=1.0.0
```

### **Scripts de Desarrollo**

```bash
# Backend
cd backend
mvn spring-boot:run                    # Desarrollo (puerto 8080)
mvn clean package                      # Build para producciÃ³n
mvn test                              # Tests unitarios

# Frontend  
cd frontend
npm start                             # Desarrollo (puerto 3000)
npm run build                         # Build optimizado
npm test                              # Tests React

# Base de datos
mysql -u root -p < db/setup_database.sql    # Setup inicial
```

---

## **ğŸ§ª Testing y Calidad**

### **Testing Strategy**

| Capa | Herramienta | Cobertura |
|------|-------------|-----------|
| **Unit Tests (Backend)** | JUnit 5 + Mockito | Services, Repositories |
| **Integration Tests** | Spring Boot Test | Controllers, Security |
| **Frontend Tests** | Jest + React Testing Library | Components, Hooks |
| **E2E Tests** | Cypress (planificado) | Flujos crÃ­ticos |

### **Code Quality**

- **Backend**: SonarQube, Checkstyle, SpotBugs
- **Frontend**: ESLint, TypeScript strict mode, SonarLint
- **Database**: Flyway migrations, constraints FK
- **Security**: OWASP dependency check, JWT best practices

---

## **ğŸš€ Deployment y Infraestructura**

### **Ambientes**

| Ambiente | Base de Datos | URL | CaracterÃ­sticas |
|----------|---------------|-----|-----------------|
| **Development** | MySQL local | localhost:3000/8080 | Hot reload, debug logs |
| **Staging** | MySQL Cloud | staging.impulse.app | Datos de prueba |
| **Production** | MySQL RDS | impulse.app | SSL, CDN, monitoring |

### **ContenarizaciÃ³n (Docker)**

```dockerfile
# Backend
FROM openjdk:21-jre-slim
COPY target/impulse-backend.jar app.jar
EXPOSE 8080
CMD ["java", "-jar", "app.jar"]

# Frontend  
FROM nginx:alpine
COPY build/ /usr/share/nginx/html/
EXPOSE 80
```

### **CI/CD Pipeline**

```yaml
# GitHub Actions / Jenkins
1. Trigger: Push to main branch
2. Tests: Unit + Integration
3. Build: Maven + npm build  
4. Security: Dependency scan
5. Deploy: Docker containers
6. Smoke tests: Health checks
```

---

## **ğŸ“Š Monitoreo y Observabilidad**

### **MÃ©tricas de Negocio**
- Usuarios activos diarios/mensuales
- Retos creados/completados por perÃ­odo
- Tasa de validaciÃ³n de evidencias
- Tiempo promedio de completar retos

### **MÃ©tricas TÃ©cnicas**
- Response time API endpoints
- Throughput (requests/second)
- Error rate por endpoint
- Uso de CPU/memoria/disco

### **Logging**
```java
// Backend: Logback + structured logging
Logger.info("Reto creado", 
  kv("userId", userId),
  kv("retoId", retoId),
  kv("categoria", categoria)
);

// Frontend: Console + error reporting
console.error('API Error:', { endpoint, error, userId });
```

---

## **ğŸ”® Roadmap TÃ©cnico**

### **PrÃ³ximas Implementaciones**
1. **Notificaciones push**: Service Workers + Firebase
2. **Chat en tiempo real**: WebSockets + Socket.io
3. **App mÃ³vil**: React Native compartiendo lÃ³gica
4. **Analytics avanzados**: IntegraciÃ³n con Google Analytics 4
5. **Machine Learning**: Recomendaciones de retos personalizados

### **Optimizaciones Planificadas**
1. **Caching**: Redis para sesiones y datos frecuentes
2. **CDN**: Assets estÃ¡ticos en CloudFront
3. **Database**: Ãndices optimizados, query performance
4. **Security**: Rate limiting, WAF, penetration testing

---

## **ğŸ›¡ï¸ Consideraciones de Seguridad**

### **Vulnerabilidades Mitigadas**
- **XSS**: Content Security Policy, sanitizaciÃ³n
- **CSRF**: SameSite cookies, tokens CSRF
- **SQL Injection**: Prepared statements, JPA
- **JWT Attacks**: Secret rotation, expiration times
- **File Upload**: ValidaciÃ³n tipo/tamaÃ±o, storage seguro

### **Compliance**
- **GDPR**: ExportaciÃ³n/eliminaciÃ³n de datos usuario
- **Accessibility**: WCAG 2.1 AA compliance
- **Privacy**: EncriptaciÃ³n datos sensibles, audit trails

---

## **ğŸ“ˆ MÃ©tricas de Performance**

### **Frontend (Core Web Vitals)**
- **LCP** (Largest Contentful Paint): < 2.5s
- **FID** (First Input Delay): < 100ms  
- **CLS** (Cumulative Layout Shift): < 0.1
- **Bundle size**: < 500KB gzipped

### **Backend (SLA targets)**
- **API Response time**: p95 < 200ms
- **Availability**: 99.9% uptime
- **Database queries**: < 50ms average
- **Concurrent users**: 1000+ supported

---

## **ğŸ¯ PLAN DE IMPLEMENTACIÃ“N: NAVEGACIÃ“N SEGURA Y ROBUSTA**

## **Bloque 1 â€” Frontend (React + TypeScript)**

### **Objetivo general**
Construir una navegaciÃ³n fiable, segura y predecible que:
- haga alcanzables por URL todas las pantallas (incluido refresh directo)
- garantice un botÃ³n "AtrÃ¡s" coherente en cualquier punto (sin "encierros")
- preserve estado relevante en la URL (filtros, paginaciÃ³n, pestaÃ±as)
- soporte deep links (internos y desde notificaciones externas)
- respete privacidad y roles
- cumpla accesibilidad y seguridad en cliente

### **Condiciones innegociables**
- Nada de JWT en localStorage/sessionStorage. La sesiÃ³n viaja en cookies HttpOnly.
- Cero PII ni secretos en la URL (incluye query params).
- Rutas canÃ³nicas y estables (no dependas de IDs opacos visibles si comprometen privacidad).
- Privacidad por diseÃ±o:
  - Si el recurso es privado y el usuario no tiene acceso: mostrar 404 (evita enumeraciÃ³n).
  - Si el recurso no es privado pero el usuario carece de permiso: 403.
- Deep link: si el usuario no estÃ¡ autenticado, redirigir a /login?continue=<destino> y, tras login, navegar con replace para que "AtrÃ¡s" no vuelva al login.
- Back coherente: si no hay historial (entrada directa), "AtrÃ¡s" cae a un fallback sano (Dashboard).
- Estado = URL: todo filtro/paginaciÃ³n/orden/pestaÃ±a de listas debe persistir en la URL y restaurarse al volver/recargar.

### **Requisitos funcionales de navegaciÃ³n**
- PÃºblicas: Home, Login, Register, Onboarding.
- Privadas (auth): Dashboard, Mis Retos, Crear Reto (wizard), Reto Detalle (+ sub-vistas), Perfil, ConfiguraciÃ³n, Notificaciones.
- Rol: Validaciones (VALIDADOR), Validadores (segÃºn rol).
- Errores dedicados: 403, 404 con CTA claro para salir (p. ej., "Volver al Dashboard").
- Modales basados en navegaciÃ³n: cuando se abra una vista en modal (p. ej., previsualizaciÃ³n de evidencia), el back debe cerrar el modal y regresar a la pantalla base, no a una pÃ¡gina anterior irrelevante.
- Wizards: al completar, navegar con replace al destino final para no acumular pasos en el historial.

### **Seguridad en cliente**
- CSRF: el cliente incluye cookies en todas las llamadas y, en mÃ©todos mutadores, envÃ­a el token CSRF en header (doble cookie).
- CORS: el cliente no asume *; debe funcionar con allowlist estricta.
- CSP: no depender de eval/inline scripts no permitidos; respetar una CSP estricta (solo 'self', data: para imÃ¡genes si es imprescindible).
- Uploads: nunca renderizar HTML no confiable; previsualizaciones seguras; no ejecutar contenido activo.

### **Accesibilidad y UX**
- GestiÃ³n de foco al cambiar de vista (llevar foco al h1 o contenedor principal).
- RestauraciÃ³n de scroll por ruta.
- Breadcrumbs o equivalente para "salir" de niveles profundos sin depender del navegador.
- MensajerÃ­a clara en 403/404 con acciones sugeridas.
- Estados vacÃ­os consistentes (sin duda sobre quÃ© hacer).
- i18n: textos navegacionales y errores localizados.

### **Rendimiento y resiliencia**
- Transiciones rÃ¡pidas; evita recargas innecesarias de datos al navegar entre sub-vistas del mismo recurso.
- Prefetch oportuno (datos del detalle al pasar desde la lista, si no penaliza).
- Fallback offline/errores controlados (no pantallas en blanco).

### **Casos lÃ­mite a cubrir**
- Entrar por URL profunda sin sesiÃ³n (login â†’ continuar).
- Entrar por URL a un recurso privado de otro usuario (debe resultar en 404).
- Abrir modal por URL (copiable/compartible) y cerrarlo con "AtrÃ¡s".
- Cambiar filtros/orden y recargar: el estado debe restaurarse igual.
- Navegar desde notificaciÃ³n externa (sin historial) y luego pulsar "AtrÃ¡s" â†’ fallback.
- Cambiar de rol (p. ej., sesiÃ³n de validador) y acceder a rutas restringidas.

### **Criterios de aceptaciÃ³n (Frontend)**
- Deep links: 100% de rutas privadas redirigen a login con continue; tras login se regresa al destino con replace.
- Back seguro: en detalles y modales, "AtrÃ¡s" vuelve a la base o al fallback si no hay historial.
- URL-estado: filtros, paginaciÃ³n y vista se preservan navegando y al volver.
- Privacidad: 404 para recursos privados ajenos; 403 para "no autorizado" en pÃºblicos restringidos.
- Accesibilidad: foco y scroll gestionados; 403/404 accesibles y navegables.
- E2E: cobertura de pÃºblicas, privadas, rol, deep link sin historial, modales, 403/404, y persistencia de filtros.

## **Bloque 2 â€” Backend (Spring Boot + Java, MySQL 8)**

### **Objetivo general**
Proveer puntos de control de seguridad y contexto para que la navegaciÃ³n del frontend:
- resuelva autenticaciÃ³n con cookies HttpOnly y CSRF
- aplique autorizaciÃ³n de objeto (OBO) para Reto/Evidencia
- soporte deep links seguros desde notificaciones
- entregue cÃ³digos de error coherentes (404/403)
- y cumpla OWASP/GDPR/ENS/ISO en lo que afecta a navegaciÃ³n y exposiciÃ³n de datos

### **Condiciones innegociables**
- AutenticaciÃ³n por cookies:
  - IMPULSE_TOKEN (acceso corto, HttpOnly+Secure+SameSite)
  - IMPULSE_REFRESH (rotativa, HttpOnly+Secure+SameSite, "one per use")
- CSRF habilitado con doble cookie (emites XSRF-TOKEN no-HttpOnly; exiges X-XSRF-TOKEN en mutadores).
- CORS allowlist (dominios exactos; credenciales habilitadas).
- Headers de seguridad: CSP estricta, HSTS, Referrer-Policy, X-Content-Type-Options, frame-ancestors 'none', Permissions-Policy mÃ­nima.
- Sin tokens en URLs; nada de JWT/credenciales en query strings.
- Errores homogÃ©neos; sin stacktrace ni filtrado de detalles internos.

### **Reglas de autorizaciÃ³n (OBO)**
- Reto/Evidencia â€“ Ver: dueÃ±o o validador asignado.
- Reto/Evidencia â€“ Editar: dueÃ±o (o ADMIN segÃºn polÃ­tica).
- Privado sin acceso â†’ 404 (evita enumeraciÃ³n).
- No privado sin permiso â†’ 403.
- Endpoints de listas filtran por permisos efectivos (no revelar conteos que delaten existencia).

### **Deep links seguros**
- Las URLs pÃºblicas (ej.: /reto/:id) no llevan secretos.
- Para notificaciones externas que precisan contexto, usa cÃ³digo efÃ­mero de un uso (servidor resuelve y redirige a la ruta interna).
- Todo deep link resuelto deja traza de auditorÃ­a (quiÃ©n, quÃ©, cuÃ¡ndo).

### **Integridad y privacidad**
- No logging de PII sensible en rutas de navegaciÃ³n; token/cookies jamÃ¡s en logs.
- Trazabilidad de decisiones (validaciones âœ”ï¸/âŒ, acceso a evidencias) con IDs internos.
- PolÃ­tica de 404/403 aplicada de forma consistente en todos los controladores.
- Rate limiting en endpoints de autenticaciÃ³n y rutas calientes.

### **Rendimiento y estabilidad**
- p95 < 200ms en endpoints de lectura usados por navegaciÃ³n.
- PaginaciÃ³n predeterminada en listados.
- Cache-Control sensato en recursos estÃ¡ticos y no sensibles (lado reverse proxy).
- Mensajes de error cortos, consistentes, versionados.

### **Casos lÃ­mite a cubrir**
- Refresh de token caducado sin perder el continue del flujo.
- Acceso a recurso borrado (404, sin filtrar si existiÃ³ o no).
- Cambio de rol y acceso a rutas restringidas.
- Concurrente: ediciÃ³n/validaciÃ³n mientras otro usuario consulta (coherencia de estados).
- Uploads maliciosos (rechazo, auditorÃ­a, sin fuga de detalles).

### **Criterios de aceptaciÃ³n (Backend)**
- Auth: login emite cookies; refresh rota; logout revoca; todo stateless.
- CSRF: mutadores sin token â†’ 403; con token â†’ OK.
- CORS/Headers: configuraciÃ³n estricta; sin wildcard con credenciales.
- OBO: reglas aplicadas de forma uniforme (tests de acceso positivo y negativo).
- Errores: 404/403 correctos segÃºn privacidad; formato uniforme; sin stacktrace.
- Deep link: cÃ³digos efÃ­meros (un uso, expiraciÃ³n corta) y auditorÃ­a.
- Observabilidad: mÃ©tricas y logs estructurados sin PII sensible.

### **No-objetivos (para que no haya ambigÃ¼edad)**
- No se permiten tokens en cliente fuera de cookies HttpOnly.
- No se liberan endpoints "atajo" que salten OBO/CSRF/CORS.
- No se exponen IDs sensibles si comprometen privacidad del modelo.
- No se aceptan respuestas ambiguas (deben mapearse a 403/404 claras).

### **SeÃ±ales de Ã©xito (cÃ³mo sabremos que estÃ¡ bien)**
- Cualquier URL compartida de una pantalla abre exactamente esa pantalla tras login, con su estado intacto.
- El usuario nunca queda atrapado en un modal o flujo; "AtrÃ¡s" siempre tiene salida segura.
- No hay fugas de existencia de recursos privados (404 consistente).
- NingÃºn test E2E de navegaciÃ³n falla al variar rol/sesiÃ³n/deep link.
- ZAP/DAST sin hallazgos crÃ­ticos en rutas de navegaciÃ³n.

### **QuÃ© esperamos de Copilot**
- Elegir y aplicar el mejor patrÃ³n de implementaciÃ³n disponible en el stack actual sin alterar la estructura de proyecto.
- Autocompletar y generar el cÃ³digo necesario respetando estas condiciones y criterios de aceptaciÃ³n.
- Propagar estas reglas de seguridad y UX a todas las rutas existentes y futuras.
- Mantener la soluciÃ³n autoexplicable (nombres claros, comentarios breves donde aÃ±ada valor) y alineada con el manual.

---

Esta documentaciÃ³n proporciona una visiÃ³n completa de **IMPULSE** desde perspectiva tÃ©cnica, cubriendo arquitectura, implementaciÃ³n, configuraciÃ³n y consideraciones operacionales, ademÃ¡s del plan detallado para implementar navegaciÃ³n segura y robusta segÃºn los mÃ¡s altos estÃ¡ndares de seguridad y UX.
